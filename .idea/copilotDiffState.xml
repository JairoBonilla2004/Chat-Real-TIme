<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/Backend/chat_real_time/src/test/java/ec/edu/espe/chat_real_time/Service/AuthServiceImplTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Backend/chat_real_time/src/test/java/ec/edu/espe/chat_real_time/Service/AuthServiceImplTest.java" />
              <option name="originalContent" value="package ec.edu.espe.chat_real_time.Service;&#10;import ec.edu.espe.chat_real_time.Service.auth.AuthServiceImpl;&#10;import ec.edu.espe.chat_real_time.Service.refreshToken.RefreshTokenServiceImpl;&#10;import ec.edu.espe.chat_real_time.Service.user.UserServiceImpl;&#10;import ec.edu.espe.chat_real_time.dto.request.RegisterAdminRequest;&#10;import ec.edu.espe.chat_real_time.dto.response.AuthResponse;&#10;import ec.edu.espe.chat_real_time.model.Role;&#10;import ec.edu.espe.chat_real_time.model.user.User;&#10;import ec.edu.espe.chat_real_time.repository.GuestProfileRepository;&#10;import ec.edu.espe.chat_real_time.repository.RoleRepository;&#10;import ec.edu.espe.chat_real_time.repository.UserRepository;&#10;import ec.edu.espe.chat_real_time.repository.AdminProfileRepository;&#10;import ec.edu.espe.chat_real_time.security.jwt.JwtService;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;&#10;import java.util.Optional;&#10;&#10;import static org.assertj.core.api.Assertions.*;&#10;import static org.mockito.Mockito.*;&#10;&#10;class AuthServiceImplTest {&#10;&#10;    private AuthenticationManager authenticationManager;&#10;    private JwtService jwtService;&#10;    private RefreshTokenServiceImpl refreshTokenService;&#10;    private HttpRequestService httpRequestService;&#10;    private UserServiceImpl userService;&#10;    private RoleRepository roleRepository;&#10;    private GuestProfileRepository guestProfileRepository;&#10;    private AdminProfileRepository adminProfileRepository;&#10;    private PasswordEncoder passwordEncoder;&#10;    private UserRepository userRepository;&#10;&#10;    private AuthServiceImpl authService;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        authenticationManager = mock(AuthenticationManager.class);&#10;        jwtService = mock(JwtService.class);&#10;        refreshTokenService = mock(RefreshTokenServiceImpl.class);&#10;        httpRequestService = mock(HttpRequestService.class);&#10;        userService = mock(UserServiceImpl.class);&#10;        roleRepository = mock(RoleRepository.class);&#10;        guestProfileRepository = mock(GuestProfileRepository.class);&#10;        adminProfileRepository = mock(AdminProfileRepository.class);&#10;        passwordEncoder = mock(PasswordEncoder.class);&#10;        userRepository = mock(UserRepository.class);&#10;&#10;        authService = new AuthServiceImpl(&#10;                authenticationManager,&#10;                jwtService,&#10;                refreshTokenService,&#10;                httpRequestService,&#10;                userService,&#10;                roleRepository,&#10;                guestProfileRepository,&#10;                adminProfileRepository,&#10;                passwordEncoder,&#10;                userRepository&#10;        );&#10;    }&#10;&#10;    @Test&#10;    void registerAdmin_ShouldCreateAdminUserSuccessfully() {&#10;&#10;        RegisterAdminRequest request = new RegisterAdminRequest();&#10;        request.setUsername(&quot;admin123&quot;);&#10;        request.setPassword(&quot;1234&quot;);&#10;        request.setFirstName(&quot;Juan&quot;);&#10;        request.setLastName(&quot;Lopez&quot;);&#10;        request.setEmail(&quot;admin@mail.com&quot;);&#10;        request.setPhone(&quot;0999999999&quot;);&#10;&#10;        when(userRepository.existsByUsername(&quot;admin123&quot;)).thenReturn(false);&#10;        when(adminProfileRepository.existsByEmail(&quot;admin@mail.com&quot;)).thenReturn(false);&#10;&#10;        when(passwordEncoder.encode(&quot;1234&quot;)).thenReturn(&quot;encoded-pass&quot;);&#10;&#10;        Role role = new Role();&#10;        role.setId(1L);&#10;        role.setName(&quot;ROLE_ADMIN&quot;);&#10;        when(roleRepository.findByName(&quot;ROLE_ADMIN&quot;)).thenReturn(Optional.of(role));&#10;&#10;        User savedUser = new User();&#10;        savedUser.setId(10L);&#10;        savedUser.setUsername(&quot;admin123&quot;);&#10;&#10;        when(userService.saveUserDB(any(User.class))).thenReturn(Optional.of(savedUser));&#10;        when(jwtService.generateAccessToken(savedUser)).thenReturn(&quot;token-abc&quot;);&#10;&#10;        AuthResponse response = authService.registerAdmin(request);&#10;&#10;        assertThat(response).isNotNull();&#10;        assertThat(response.getAccessToken()).isEqualTo(&quot;token-abc&quot;);&#10;&#10;        verify(userService, times(1)).saveUserDB(any(User.class));&#10;        verify(jwtService, times(1)).generateAccessToken(savedUser);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package ec.edu.espe.chat_real_time.Service;&#10;import ec.edu.espe.chat_real_time.Service.auth.AuthServiceImpl;&#10;import ec.edu.espe.chat_real_time.Service.refreshToken.RefreshTokenServiceImpl;&#10;import ec.edu.espe.chat_real_time.Service.user.UserServiceImpl;&#10;import ec.edu.espe.chat_real_time.dto.request.RegisterAdminRequest;&#10;import ec.edu.espe.chat_real_time.dto.response.AuthResponse;&#10;import ec.edu.espe.chat_real_time.model.Role;&#10;import ec.edu.espe.chat_real_time.model.user.User;&#10;import ec.edu.espe.chat_real_time.repository.GuestProfileRepository;&#10;import ec.edu.espe.chat_real_time.repository.RoleRepository;&#10;import ec.edu.espe.chat_real_time.repository.UserRepository;&#10;import ec.edu.espe.chat_real_time.repository.AdminProfileRepository;&#10;import ec.edu.espe.chat_real_time.security.jwt.JwtService;&#10;import org.junit.jupiter.api.BeforeEach;&#10;import org.junit.jupiter.api.Test;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;&#10;import java.util.Optional;&#10;&#10;import static org.assertj.core.api.Assertions.*;&#10;import static org.mockito.Mockito.*;&#10;&#10;class AuthServiceImplTest {&#10;&#10;    private AuthenticationManager authenticationManager;&#10;    private JwtService jwtService;&#10;    private RefreshTokenServiceImpl refreshTokenService;&#10;    private HttpRequestService httpRequestService;&#10;    private UserServiceImpl userService;&#10;    private RoleRepository roleRepository;&#10;    private GuestProfileRepository guestProfileRepository;&#10;    private AdminProfileRepository adminProfileRepository;&#10;    private PasswordEncoder passwordEncoder;&#10;    private UserRepository userRepository;&#10;&#10;    private AuthServiceImpl authService;&#10;&#10;    @BeforeEach&#10;    void setUp() {&#10;        authenticationManager = mock(AuthenticationManager.class);&#10;        jwtService = mock(JwtService.class);&#10;        refreshTokenService = mock(RefreshTokenServiceImpl.class);&#10;        httpRequestService = mock(HttpRequestService.class);&#10;        userService = mock(UserServiceImpl.class);&#10;        roleRepository = mock(RoleRepository.class);&#10;        guestProfileRepository = mock(GuestProfileRepository.class);&#10;        adminProfileRepository = mock(AdminProfileRepository.class);&#10;        passwordEncoder = mock(PasswordEncoder.class);&#10;        userRepository = mock(UserRepository.class);&#10;&#10;        authService = new AuthServiceImpl(&#10;                authenticationManager,&#10;                jwtService,&#10;                refreshTokenService,&#10;                httpRequestService,&#10;                userService,&#10;                roleRepository,&#10;                guestProfileRepository,&#10;                adminProfileRepository,&#10;                passwordEncoder,&#10;                userRepository&#10;        );&#10;    }&#10;&#10;    @Test&#10;    void registerAdmin_ShouldCreateAdminUserSuccessfully() {&#10;&#10;        RegisterAdminRequest request = new RegisterAdminRequest();&#10;        request.setUsername(&quot;admin123&quot;);&#10;        request.setPassword(&quot;1234&quot;);&#10;        request.setFirstName(&quot;Juan&quot;);&#10;        request.setLastName(&quot;Lopez&quot;);&#10;        request.setEmail(&quot;admin@mail.com&quot;);&#10;        request.setPhone(&quot;0999999999&quot;);&#10;&#10;        when(userRepository.existsByUsername(&quot;admin123&quot;)).thenReturn(false);&#10;        when(adminProfileRepository.existsByEmail(&quot;admin@mail.com&quot;)).thenReturn(false);&#10;&#10;        when(passwordEncoder.encode(&quot;1234&quot;)).thenReturn(&quot;encoded-pass&quot;);&#10;&#10;        final Role role = new Role();&#10;        role.setId(1L);&#10;        role.setName(&quot;ROLE_ADMIN&quot;);&#10;        when(roleRepository.findByName(&quot;ROLE_ADMIN&quot;)).thenReturn(Optional.of(role));&#10;&#10;        User savedUser = new User();&#10;        savedUser.setId(10L);&#10;        savedUser.setUsername(&quot;admin123&quot;);&#10;        // ensure role set and admin profile present on returned savedUser&#10;        savedUser.setRoles(new java.util.HashSet&lt;&gt;());&#10;        savedUser.getRoles().add(role);&#10;        ec.edu.espe.chat_real_time.model.user.AdminProfile savedProfile = new ec.edu.espe.chat_real_time.model.user.AdminProfile();&#10;        savedProfile.setFirstName(&quot;Juan&quot;);&#10;        savedProfile.setLastName(&quot;Lopez&quot;);&#10;        savedProfile.setEmail(&quot;admin@mail.com&quot;);&#10;        savedProfile.setPhone(&quot;0999999999&quot;);&#10;        savedProfile.setUser(savedUser);&#10;        savedUser.setAdminProfile(savedProfile);&#10;&#10;        when(userService.saveUserDB(any(User.class))).thenReturn(Optional.of(savedUser));&#10;        when(jwtService.generateAccessToken(savedUser)).thenReturn(&quot;token-abc&quot;);&#10;&#10;        AuthResponse response = authService.registerAdmin(request);&#10;&#10;        assertThat(response).isNotNull();&#10;        assertThat(response.getAccessToken()).isEqualTo(&quot;token-abc&quot;);&#10;&#10;        verify(userService, times(1)).saveUserDB(any(User.class));&#10;        verify(jwtService, times(1)).generateAccessToken(savedUser);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>